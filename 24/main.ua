∩°□°⊟⊜(□⊜□≠@\n.)¬⦷"\n\n".&fras"input"
:map≡(°□⊙⋕°⊟⊜□¬⦷": ".°□)
≡(⊂□°□:⊏1_0_2⊜□≠@ .°□°⊟⊜□¬⦷" -> ".°□)

⍢(
  ⊙:°□:°⊟⊕□↧∩(≡has)⊙,°⊟⊏2_3⍉⊙:.⊙(¤.)
  ∧(insert⊙(⍣(↥°"OR"|◿2+°"XOR"|↧°"AND")⊙(∩get⊙,))°{⊙⊙⊙∘}⊙.)
  °□:
)(
  ¬≍0_4△
)
◌
°⋯⊏:⊙⍏▽⊙(:▽).⊢⍉⌕@z.°map
